<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîó Scraping Test Page</title>
    <style>
        body {
            background-color: #0a0a0a;
            color: white;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            background-color: #16a34a;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            background-color: #333;
            border: 1px solid #555;
            border-radius: 5px;
            color: white;
            box-sizing: border-box;
        }
        .btn {
            background-color: #16a34a;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        .btn:hover {
            background-color: #15803d;
        }
        .btn:disabled {
            background-color: #666;
            cursor: not-allowed;
        }
        .quick-tests {
            background-color: #1f2937;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .quick-test-btn {
            background-color: #2563eb;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 12px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        .success {
            background-color: #16a34a;
        }
        .error {
            background-color: #dc2626;
        }
        .loading {
            background-color: #d97706;
        }
        .image-preview {
            margin-top: 10px;
        }
        .image-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 5px;
            border: 1px solid #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üîó SCRAPING TEST PAGE</h1>
            <p>Test the "Fill" button functionality for wholesale product scraping</p>
        </div>

        <!-- Quick Test URLs -->
        <div class="quick-tests">
            <h3>üöÄ Quick Test URLs:</h3>
            <button class="quick-test-btn" onclick="setUrl('https://fourhands.com/product/248067-003')">
                Four Hands (Fenn Chair)
            </button>
            <button class="quick-test-btn" onclick="setUrl('https://uttermost.com/product/27644-1')">
                Uttermost
            </button>
            <button class="quick-test-btn" onclick="setUrl('https://reginaandrew.com/collections/furniture/products/lacquer-desk-natural')">
                Regina Andrew
            </button>
        </div>

        <!-- Main Form -->
        <div style="background-color: #1f2937; padding: 20px; border-radius: 10px;">
            <h2 style="color: #d4a574;">Product Information Form</h2>
            
            <!-- Link Input & Fill Button -->
            <div class="form-group" style="background-color: #374151; padding: 15px; border-radius: 5px;">
                <label for="link">Product Link (URL)</label>
                <div style="display: flex; gap: 10px;">
                    <input type="url" id="link" placeholder="https://fourhands.com/product/248067-003" style="flex: 1;">
                    <button class="btn" id="fillBtn" onclick="scrapeProduct()">üîó FILL</button>
                </div>
                <div id="status"></div>
            </div>

            <!-- Form Fields -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label for="name">Item Name</label>
                    <input type="text" id="name" placeholder="e.g., Fenn Chair">
                </div>
                <div class="form-group">
                    <label for="vendor">Vendor</label>
                    <input type="text" id="vendor" placeholder="e.g., Four Hands">
                </div>
                <div class="form-group">
                    <label for="cost">Cost</label>
                    <input type="number" id="cost" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label for="finish_color">Finish/Color</label>
                    <input type="text" id="finish_color" placeholder="e.g., Champagne Mongolian Fur">
                </div>
                <div class="form-group">
                    <label for="size">Size</label>
                    <input type="text" id="size" placeholder="e.g., 24W x 30H x 28D">
                </div>
                <div class="form-group">
                    <label for="image_url">Image URL</label>
                    <input type="url" id="image_url" placeholder="Auto-filled from scraping">
                </div>
            </div>

            <!-- Remarks -->
            <div class="form-group">
                <label for="remarks">Remarks/Description</label>
                <textarea id="remarks" rows="4" placeholder="Product description will be auto-filled from scraping"></textarea>
            </div>

            <!-- Image Preview -->
            <div class="image-preview" id="imagePreview" style="display: none;">
                <label>Image Preview</label>
                <div>
                    <img id="previewImg" alt="Product Image">
                </div>
            </div>

            <!-- View Data Button -->
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="viewFormData()" style="background-color: #d4a574; color: black;">
                    üìã VIEW FORM DATA
                </button>
            </div>
        </div>

        <!-- Instructions -->
        <div style="margin-top: 20px; background-color: #1f2937; padding: 15px; border-radius: 10px;">
            <h3 style="color: #d4a574;">üîß Testing Instructions:</h3>
            <ol style="color: #d1d5db;">
                <li>Click one of the "Quick Test URLs" above to auto-fill the link field</li>
                <li>Click the green "üîó FILL" button to test scraping</li>
                <li>Watch the form fields get automatically populated</li>
                <li>Check the "Image Preview" section to see if images load</li>
                <li>Click "üìã VIEW FORM DATA" to see all extracted data</li>
            </ol>
        </div>
    </div>

    <script>
        function setUrl(url) {
            document.getElementById('link').value = url;
        }

        async function scrapeProduct() {
            const link = document.getElementById('link').value;
            const statusDiv = document.getElementById('status');
            const fillBtn = document.getElementById('fillBtn');

            if (!link || !link.startsWith('http')) {
                statusDiv.innerHTML = '<div class="status error">‚ùå Please enter a valid URL starting with http:// or https://</div>';
                return;
            }

            // Show loading state
            fillBtn.disabled = true;
            fillBtn.textContent = '‚è≥ SCRAPING...';
            statusDiv.innerHTML = '<div class="status loading">üîÑ Scraping product data...</div>';

            try {
                const response = await fetch('https://luxdesigntool.preview.emergentagent.com/api/scrape-product', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: link })
                });

                console.log('Response status:', response.status);

                if (!response.ok) {
                    const errorData = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorData}`);
                }

                const responseData = await response.json();
                console.log('Scraping success:', responseData);
                
                // Handle response format: {success: true, data: {...}}
                const data = responseData.success ? responseData.data : responseData;
                
                if (!data || (!data.name && !data.vendor && !data.price && !data.cost)) {
                    throw new Error('No product data could be extracted from this URL');
                }
                
                // Update form fields
                if (data.name) document.getElementById('name').value = data.name;
                if (data.vendor) document.getElementById('vendor').value = data.vendor;
                if (data.price || data.cost) {
                    const price = data.price || data.cost;
                    document.getElementById('cost').value = parseFloat(price.toString().replace(/[$,]/g, '')) || '';
                }
                if (data.finish_color || data.color || data.finish) {
                    document.getElementById('finish_color').value = data.finish_color || data.color || data.finish;
                }
                if (data.size || data.dimensions) {
                    document.getElementById('size').value = data.size || data.dimensions;
                }
                if (data.image_url || data.image) {
                    const imageUrl = data.image_url || data.image;
                    document.getElementById('image_url').value = imageUrl;
                    showImagePreview(imageUrl);
                }
                if (data.description) {
                    document.getElementById('remarks').value = data.description.substring(0, 500);
                }
                
                statusDiv.innerHTML = `<div class="status success">‚úÖ SUCCESS! Extracted: ${data.name || 'Product'} from ${data.vendor || 'Unknown Vendor'}</div>`;
                
            } catch (error) {
                console.error('Scraping error:', error);
                statusDiv.innerHTML = `<div class="status error">‚ùå SCRAPING FAILED: ${error.message}</div>`;
            } finally {
                fillBtn.disabled = false;
                fillBtn.textContent = 'üîó FILL';
            }
        }

        function showImagePreview(imageUrl) {
            const preview = document.getElementById('imagePreview');
            const img = document.getElementById('previewImg');
            
            img.src = imageUrl;
            img.onload = () => {
                preview.style.display = 'block';
            };
            img.onerror = () => {
                preview.style.display = 'none';
            };
        }

        function viewFormData() {
            const formData = {
                name: document.getElementById('name').value,
                vendor: document.getElementById('vendor').value,
                cost: document.getElementById('cost').value,
                link: document.getElementById('link').value,
                finish_color: document.getElementById('finish_color').value,
                image_url: document.getElementById('image_url').value,
                size: document.getElementById('size').value,
                remarks: document.getElementById('remarks').value
            };
            
            alert('Form Data:\n' + JSON.stringify(formData, null, 2));
        }

        // Auto-load Four Hands URL on page load
        window.onload = function() {
            setUrl('https://fourhands.com/product/248067-003');
        };
    </script>
</body>
</html>